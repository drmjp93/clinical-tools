<!doctype html>

<html lang="en">
<head>
  
<link rel="apple-touch-icon" href="/apple-touch-icon.png">  
<link rel="icon" type="image/png" sizes="32x32" href="/favicon.png"> 

<meta property="og:image" content="https://tools.drmjp93.in/icon-512.png">
<meta property="og:title" content="Clinical Tools | Dr. Mit Panchani">
<meta property="og:description" content="Practical bedside clinical calculators & tools">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">

<title>Clinical Tools | Dr. Mit Panchani</title>

<link rel="manifest" href="/manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Clinical Tools">
<link rel="apple-touch-icon" href="/icon-192.png">

<style>

:root{
  --bg:#0f1113;
  --card:#16191d;
  --inner:#0b0d10;
  --border:#262a30;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --accent:#3b82f6;
  --success:#064e3b;
  --warn:#78350f;
  --info:#1e3a8a;
}

*{box-sizing:border-box}
  
body{
  margin:0;
  color:var(--text);
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background-color: var(--bg);
}

body::before{
  content:"";
  position:fixed;
  inset:0;
  z-index:-1;

  background-image:
    linear-gradient(
      rgba(0,0,0,0.75),
      rgba(0,0,0,0.75)
    ),
    url("./bg.jpg");

  background-repeat: repeat;
  background-size: 600px;
  background-position: top left;
}

main{
  max-width:1000px;
  margin:24px auto;
  padding:16px;
}

h1{font-size:1.6rem;margin-bottom:4px}
.sub{color:var(--muted);font-size:.9rem;margin-bottom:16px}

/* MODE */
.mode-toggle{display:flex;gap:12px;margin-bottom:18px}
.mode-btn{
  flex:1;padding:14px;border-radius:14px;
  border:1px solid var(--border);
  background:var(--card);color:var(--muted);
  font-weight:600;cursor:pointer
}
.mode-btn.active{background:#fff;color:#000}


/* ===== SPLASH SCREEN ===== */
.splash{
  position: fixed;
  inset: 0;
  background: #0f1113;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
}

.splash-card{
  text-align: center;
  animation: splashFade 0.5s ease;
}

.splash-title{
  font-size: 1.5rem;
  font-weight: 700;
  margin-bottom: 6px;
}

.splash-name{
  font-size: 1rem;
  color: #e5e7eb;
}

.splash-degree{
  font-size: 0.85rem;
  color: #9ca3af;
  margin-top: 2px;
}

@keyframes splashFade{
  from{opacity:0; transform:translateY(8px)}
  to{opacity:1; transform:none}
}


/* ===== Floating ICU Dose Modal ===== */

.ghost-btn{
  margin:10px 0;
  background:rgba(59,130,246,0.08);
  border:1px dashed var(--border);
  color:var(--text-dim);
  padding:10px;
  border-radius:10px;
  cursor:pointer;
  font-weight:600;
}
.ghost-btn:hover{
  color:#fff;
  border-color:var(--accent);
}



.dose-modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:9999;
}

.dose-card{
  width:min(520px,92%);
  background:#0b0f16;
  border-radius:16px;
  box-shadow:0 20px 60px rgba(0,0,0,.6);
  overflow:hidden;
}

.dose-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px 16px;
  background:#121826;
  font-weight:700;
}

.dose-header button{
  background:none;
  border:none;
  color:#aaa;
  font-size:18px;
  cursor:pointer;
}

.dose-body{
  padding:16px;
  max-height:70vh;
  overflow:auto;
}

.dose-section{margin-bottom:16px}
.dose-section h4{
  margin:0 0 8px;
  color:#7aa2ff;
  font-size:.9rem;
  text-transform:uppercase;
}

.dose-row{
  display:flex;
  justify-content:space-between;
  padding:8px 10px;
  border-radius:8px;
  background:#0f1420;
  margin-bottom:6px;
  font-size:.9rem;
}

.dose-row span{color:#a5c8ff}

.dose-note{
  margin-top:12px;
  font-size:.75rem;
  color:#888;
}

.hidden{display:none}

/* ===== ICU FORM UI (GLOBAL) ===== */

.form-card {
  background: #0b0f14;
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 16px;
  margin-bottom: 16px;
}

.form-section-title {
  font-weight: 700;
  margin-bottom: 12px;
  color: var(--text);
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: 6px;
}

.form-label {
  font-size: 0.85rem;
  color: var(--muted);
}

.form-input,
.form-select {
  padding: 12px;
  border-radius: 10px;
  border: 1px solid var(--border);
  background: #0f141a;
  color: var(--text);
  font-size: 0.95rem;
}

.form-input:focus,
.form-select:focus {
  outline: none;
  border-color: var(--accent);
}

.form-row {
  display: grid;
  grid-template-columns: 2fr 1fr;
  gap: 12px;
}

.form-row-2 {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
}

.primary-btn {
  width: 100%;
  padding: 14px;
  margin-top: 8px;
  border-radius: 14px;
  border: none;
  background: var(--accent);
  color: #fff;
  font-weight: 700;
  cursor: pointer;
}

.primary-btn:hover {
  opacity: 0.9;
}

/* SEARCH */
.search input{
  width:100%;padding:14px;border-radius:12px;
  border:1px solid var(--border);
  background:#0b0d0f;color:var(--text);
  margin-bottom:14px
}

/* GLOBAL SORT BAR */
.tabs{
  display:flex;gap:10px;margin:0 0 18px;overflow-x:auto
}
.tabs::-webkit-scrollbar{display:none}
.tab{
  padding:8px 14px;border-radius:999px;
  border:1px solid var(--border);
  background:var(--card);
  color:var(--muted);
  cursor:pointer;font-size:.85rem;
  white-space:nowrap
}
.tab.active{background:#fff;color:#000;font-weight:600}

/* TOOL */
.tool{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:14px;
  margin-bottom:14px;
  overflow:hidden
}
.tool summary{
  list-style:none;padding:16px;
  cursor:pointer;display:flex;
  justify-content:space-between
}
.tool summary::-webkit-details-marker{display:none}
.tool-title{font-weight:600}
.tool-sub{font-size:.8rem;color:var(--muted)}
.tool-body{padding:16px;border-top:1px solid var(--border)}

/* STEPS */
.step{
  background:var(--inner);
  border:1px solid var(--border);
  border-radius:12px;
  padding:14px;margin-bottom:14px
}
.step-title{font-weight:600;margin-bottom:8px}

.options button{
  padding:14px 10px;
  border-radius:12px;
  border:1px solid #374151;
  background:#020617;          /* darker background */
  color:#e5e7eb;
  font-weight:600;
  min-height:56px;
  cursor:pointer;
  transition:all 0.15s ease;
}

/* HOVER (desktop) */
.options button:hover{
  background:#020617;
  border-color:#60a5fa;
}

/* SELECTED (critical for GCS clarity) */
.options button.selected{
  background:linear-gradient(135deg,#1d4ed8,#2563eb);
  border-color:#93c5fd;
  color:#ffffff;
  box-shadow:0 0 0 2px rgba(59,130,246,0.35);
}
.options button.selected{
  background:var(--accent);
  border-color:var(--accent)
}

/* RESULT */
.result{
  padding:14px;border-radius:12px;
  font-weight:700;margin-top:12px
}
.success{background:var(--success);color:#d1fae5}
.warn{background:var(--warn);color:#fde68a}
.info{background:var(--info);color:#dbeafe}

.monitor{
  margin-top:12px;padding:12px;
  border-radius:12px;
  border:1px dashed var(--border);
  font-size:.9rem;color:var(--muted)
}

.hidden{display:none}

/* ===== Mobile overflow fix for result boxes ===== */

.tool-body,
.step,
.result,
.monitor {
  max-width: 100%;
  overflow-wrap: break-word;
  word-break: break-word;
}

.result {
  box-sizing: border-box;
  width: 100%;
}
/* === iOS GRID FIX === */
input, button {
  max-width: 100%;
  min-width: 0;
}

.tool-body * {
  box-sizing: border-box;
}

.sep{
  margin: 0 6px;
  opacity: 0.6;
}

.visitor-count{
  font-weight: 400;
}

.visitor-count b{
  font-weight: 700;
}

  /* ===== Mobile fix for Infusion Calculator ===== */
@media (max-width: 520px) {

  .form-row,
  .form-row-2 {
    grid-template-columns: 1fr !important;
  }

  .form-card {
    padding: 14px;
  }

  .form-input,
  .form-select {
    width: 100%;
  }
}
</style>
</head>

<body>
  
  <!-- SPLASH SCREEN -->
<div id="splash" class="splash">
  <div class="splash-card">
    <div class="splash-title">Clinical Tools</div>
    <div class="splash-name">By Dr. Mit Panchani</div>
    <div class="splash-degree">MD (General Medicine)</div>
  </div>
</div>
  
  
<main>

<h1>Clinical Tools</h1>
<div class="sub">
  Quick OPD decision support
  <span class="sep"> | </span>
  <span class="visitor-count">
    Used: <b><span id="visitCount">‚Äî</span></b> times
  </span>
</div>

<!-- MODE -->
<div class="mode-toggle">
  <button class="mode-btn active" onclick="switchMode('general',this)">Adult</button>
  <button class="mode-btn" onclick="switchMode('preg',this)">Pregnancy</button>
</div>

<!-- SEARCH -->
<div class="search">
  <input id="searchInput" placeholder="Search tools‚Ä¶">
</div>

<!-- GLOBAL SORT BAR -->
<div class="tabs" id="global-tabs">
  <div class="tab active" data-filter="all">All</div>
  <div class="tab" data-filter="hepato">Hepatology</div>
  <div class="tab" data-filter="cardio">Cardiology</div>
  <div class="tab" data-filter="resp">Respiratory</div>
  <div class="tab" data-filter="Hematology">Hematology</div>
  <div class="tab" data-filter="nephro">Nephrology</div>
  <div class="tab" data-filter="endocrine">Endocrine</div>
  <div class="tab" data-filter="obstetric">Obstetric</div>
  <div class="tab" data-filter="icu">ICU</div>
  <div class="tab" data-filter="neuro">Neurology</div>
</div>

<!-- ================= GENERAL ================= -->
  
<div id="general-tools">

  
<!-- ================= HEP B ADULT TOOL ================= -->
<details class="tool" data-system="hepato">
<summary>
  <div>
    <div class="tool-title">Hepatitis B ‚Äì Chronic Infection</div>
    <div class="tool-sub">Adult (Non-pregnant)</div>
  </div>
  <div>‚ñæ</div>
</summary>

<div class="tool-body">

<div class="step">
  <div class="step-title">Step 1 ‚Äì HBeAg status</div>
  <div class="options">
    <button onclick="select(this);show('g2')">Positive</button>
    <button onclick="select(this);show('g2')">Negative</button>
  </div>
</div>

<div class="step hidden" id="g2">
  <div class="step-title">Step 2 ‚Äì HBV DNA</div>
  <div class="options">
    <button onclick="select(this);hbvDNA('high')">&gt; 20,000 IU/mL</button>
    <button onclick="select(this);hbvDNA('low')">‚â§ 20,000 IU/mL</button>
  </div>
</div>

<div class="step hidden" id="g3">
  <div class="step-title">Step 3 ‚Äì Cirrhosis</div>
  <div class="options">
    <button onclick="select(this);treat()">Yes</button>
    <button onclick="select(this);show('g4')">No</button>
  </div>
</div>

<div class="step hidden" id="g4">
  <div class="step-title">Step 4 ‚Äì ALT</div>
  <div class="options">
    <button onclick="select(this);treat()">ALT &gt; 2√ó ULN</button>
    <button onclick="select(this);monitor()">ALT ‚â§ 2√ó ULN</button>
  </div>
</div>

<div id="result" class="hidden"></div>
<div id="monitor" class="monitor hidden"></div>

</div>
</details>

<!-- ================= egfr tool================= -->
<details class="tool" data-system="nephro">
<summary>
  <div>
    <div class="tool-title">eGFR Calculator (CKD-EPI 2021)</div>
    <div class="tool-sub">Creatinine-based, race-free</div>
  </div>
  <div>‚ñæ</div>
</summary>

<div class="tool-body">

<div class="step">
  <div class="step-title">Patient details</div>

<div style="
  display:grid;
  grid-template-columns:repeat(2,minmax(0,1fr));
  gap:12px
">
    <input id="egfr-age" type="number" placeholder="Age (years)"
      style="padding:12px;border-radius:10px;border:1px solid var(--border);
             background:#0b0d0f;color:var(--text)">
    <input id="egfr-creat" type="number" step="0.01" placeholder="Serum Creatinine (mg/dL)"
      style="padding:12px;border-radius:10px;border:1px solid var(--border);
             background:#0b0d0f;color:var(--text)">
  </div>

  <div class="options" style="margin-top:12px">
    <button onclick="calcEGFR('male')">Male</button>
    <button onclick="calcEGFR('female')">Female</button>
  </div>
</div>

<div id="egfr-result" class="hidden"></div>

</div>
</details>

<script>
function calcEGFR(sex){
  const age = parseFloat(document.getElementById('egfr-age').value);
  const scr = parseFloat(document.getElementById('egfr-creat').value);
  const resultBox = document.getElementById('egfr-result');

  if(!age || !scr){
    resultBox.className = 'result warn';
    resultBox.textContent = 'Please enter valid age and creatinine values.';
    resultBox.classList.remove('hidden');
    return;
  }

  // CKD-EPI 2021 (race-free)
  let k, alpha;
  if(sex === 'female'){
    k = 0.7;
    alpha = -0.241;
  } else {
    k = 0.9;
    alpha = -0.302;
  }

  const minScr = Math.min(scr / k, 1);
  const maxScr = Math.max(scr / k, 1);

  const egfr =
    142 *
    Math.pow(minScr, alpha) *
    Math.pow(maxScr, -1.200) *
    Math.pow(0.9938, age) *
    (sex === 'female' ? 1.012 : 1);

  const egfrVal = Math.round(egfr);

  let stage = '';
  let cls = 'info';

  if(egfrVal >= 90){ stage = 'G1 (Normal or high)'; cls='success'; }
  else if(egfrVal >= 60){ stage = 'G2 (Mildly decreased)'; cls='info'; }
  else if(egfrVal >= 45){ stage = 'G3a (Mild‚ÄìModerate)'; cls='warn'; }
  else if(egfrVal >= 30){ stage = 'G3b (Moderate‚ÄìSevere)'; cls='warn'; }
  else if(egfrVal >= 15){ stage = 'G4 (Severely decreased)'; cls='warn'; }
  else { stage = 'G5 (Kidney failure)'; cls='warn'; }

  resultBox.className = 'result ' + cls;
  resultBox.innerHTML = `
    eGFR ‚âà <strong>${egfrVal} mL/min/1.73 m¬≤</strong><br>
    CKD Stage: <b>${stage}</b>
  `;
  resultBox.classList.remove('hidden');
}
</script>

<!-- ================= BMI TOOL ================= -->
  
<details class="tool" data-system="endocrine">
<summary>
  <div>
    <div class="tool-title">BMI Calculator</div>
    <div class="tool-sub">Weight & Height (Indian units)</div>
  </div>
  <div>‚ñæ</div>
</summary>

<div class="tool-body">

<div class="step">
  <div class="step-title">Enter details</div>

<div style="
  display:grid;
  grid-template-columns:repeat(2,minmax(0,1fr));
  gap:12px
">
    <input id="bmi-weight" type="number" step="0.1" placeholder="Weight (kg)"
      style="padding:12px;border-radius:10px;border:1px solid var(--border);
             background:#0b0d0f;color:var(--text)">
    <input id="bmi-height" type="number" step="0.1" placeholder="Height (cm)"
      style="padding:12px;border-radius:10px;border:1px solid var(--border);
             background:#0b0d0f;color:var(--text)">
  </div>

  <div class="options" style="margin-top:12px">
    <button onclick="calcBMI()">Calculate BMI</button>
  </div>
</div>

<div id="bmi-result" class="hidden"></div>

</div>
</details>

<script>
function calcBMI(){
  const wt = parseFloat(document.getElementById('bmi-weight').value);
  const htCm = parseFloat(document.getElementById('bmi-height').value);
  const res = document.getElementById('bmi-result');

  if(!wt || !htCm){
    res.className = 'result warn';
    res.textContent = 'Please enter valid weight and height.';
    res.classList.remove('hidden');
    return;
  }

  const htM = htCm / 100;
  const bmi = wt / (htM * htM);
  const bmiVal = bmi.toFixed(1);

  let category = '';
  let cls = 'info';

  // Indian/WHO cutoffs
  
  if(bmi < 18.5){
    category = 'Underweight';
    cls = 'warn';
  } else if(bmi < 23){
    category = 'Normal';
    cls = 'success';
  } else if(bmi < 25){
    category = 'Overweight (At risk ‚Äì Indian cutoff)';
    cls = 'warn';
  } else if(bmi < 30){
    category = 'Obese (Class I)';
    cls = 'warn';
  } else {
    category = 'Obese (Class II / III)';
    cls = 'warn';
  }

  res.className = 'result ' + cls;
  res.innerHTML = `
    BMI = <strong>${bmiVal} kg/m¬≤</strong><br>
    Category: <b>${category}</b>
    <div style="margin-top:8px;font-size:0.8rem;color:#9ca3af">
      Indian risk threshold: BMI ‚â• 23 kg/m¬≤
    </div>
  `;
  res.classList.remove('hidden');
}
</script>

  <!-- ================= THYROXINE DOSE CALCULATOR ================= -->

  
<details class="tool" data-system="endocrine">
<summary>
  <div>
    <div class="tool-title">Thyroxine Dose Calculator</div>
    <div class="tool-sub">Convert weekly variable dosing ‚Üí daily dose</div>
  </div>
  <div>‚ñæ</div>
</summary>

<div class="tool-body">

<div class="step">
  <div class="step-title">Current prescription</div>

<div style="
  display:grid;
  grid-template-columns:repeat(2,minmax(0,1fr));
  gap:12px
">
    <input id="thyroxine-strength" type="number" step="12.5"
      placeholder="Tablet strength (mcg)"
      style="padding:12px;border-radius:10px;border:1px solid var(--border);
             background:#0b0d0f;color:var(--text)">

    <input id="thyroxine-weekly" type="number" step="1"
      placeholder="Total tablets per week"
      style="padding:12px;border-radius:10px;border:1px solid var(--border);
             background:#0b0d0f;color:var(--text)">
  </div>

  <div class="options" style="margin-top:12px">
    <button onclick="calcThyroxine()">Calculate daily dose</button>
  </div>
</div>

<div id="thyroxine-result" class="hidden"></div>

</div>
</details>

<script>
function calcThyroxine(){
  const strength = parseFloat(document.getElementById('thyroxine-strength').value);
  const weeklyTabs = parseFloat(document.getElementById('thyroxine-weekly').value);
  const res = document.getElementById('thyroxine-result');

  if(!strength || !weeklyTabs){
    res.className = 'result warn';
    res.textContent = 'Please enter valid tablet strength and weekly tablet count.';
    res.classList.remove('hidden');
    return;
  }

  const weeklyDose = strength * weeklyTabs; // mcg/week
  const dailyExact = weeklyDose / 7;

  // Round to nearest 12.5 mcg (practical tablet division)
  const dailyRounded = Math.round(dailyExact / 12.5) * 12.5;

  res.className = 'result success';
  res.innerHTML = `
    Weekly dose = <b>${weeklyDose.toFixed(1)} mcg</b><br>
    Exact daily equivalent = ${dailyExact.toFixed(1)} mcg/day<br><br>
    <strong>Suggested daily dose ‚âà ${dailyRounded} mcg</strong>

    <div style="margin-top:8px;font-size:0.8rem;color:#9ca3af">
      Rounded to nearest 12.5 mcg for practical dosing.<br>
      Adjust further based on TSH (6‚Äì8 weeks).
    </div>
  `;
  res.classList.remove('hidden');
}
</script>

<!-- ================= MAP TOOL ================= -->

<details class="tool" data-system="cardio">
  <summary>
    <div>
      <div class="tool-title">Mean Arterial Pressure (MAP)</div>
      <div class="tool-sub">Hemodynamic assessment & BP emergencies</div>
    </div>
    <div>‚ñæ</div>
  </summary>

  <div class="tool-body">

    <!-- INPUTS -->
    <div class="step">
      <div class="step-title">Enter Blood Pressure</div>

      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <input id="sbp" type="number" placeholder="SBP (mmHg)"
          style="flex:1;padding:12px;border-radius:10px;border:1px solid var(--border);background:#0b0d10;color:#fff">
        <input id="dbp" type="number" placeholder="DBP (mmHg)"
          style="flex:1;padding:12px;border-radius:10px;border:1px solid var(--border);background:#0b0d10;color:#fff">
      </div>

      <button onclick="calcMAP()" style="
        margin-top:12px;
        width:100%;
        padding:12px;
        border-radius:10px;
        border:none;
        background:var(--accent);
        color:#fff;
        font-weight:600;
        cursor:pointer">
        Calculate MAP
      </button>
    </div>

    <!-- RESULT -->
    <div id="map-result" class="result info hidden"></div>

    <!-- INFORMATION -->
    <div class="monitor">
      <b>Normal MAP:</b><br>
      ‚Ä¢ 70‚Äì100 mmHg (adequate organ perfusion)<br><br>

      <b>Hypertensive Urgency:</b><br>
      ‚Ä¢ Reduce BP gradually over 24‚Äì48 hours<br>
      ‚Ä¢ No immediate MAP target<br>
      ‚Ä¢ Avoid rapid reduction<br><br>

      <b>Hypertensive Emergency:</b><br>
      ‚Ä¢ Reduce MAP by <b>‚â§25%</b> in first 1 hour<br>
      ‚Ä¢ Then target BP ‚âà 160/100 mmHg over next 2‚Äì6 hours<br>
      ‚Ä¢ Further gradual reduction over 24‚Äì48 hours
    </div>

  </div>
</details>

<script>
function calcMAP(){
  const sbp = parseFloat(document.getElementById('sbp').value);
  const dbp = parseFloat(document.getElementById('dbp').value);
  const r = document.getElementById('map-result');

  if(isNaN(sbp) || isNaN(dbp) || sbp <= dbp){
    r.className = 'result warn';
    r.textContent = 'Please enter valid SBP and DBP values.';
    r.classList.remove('hidden');
    return;
  }

  const map = Math.round((dbp + (sbp - dbp)/3)*10)/10;

  r.className = 'result success';
  r.innerHTML = `Calculated MAP: <b>${map} mmHg</b>`;
  r.classList.remove('hidden');
}
</script>

<!-- ================= LDL CALCULATOR ================= -->
  
<details class="tool" data-system="cardio">
  <summary>
    <div>
      <div class="tool-title">LDL Cholesterol Calculator</div>
      <div class="tool-sub">Embedded from existing calculator</div>
    </div>
    <div>‚ñæ</div>
  </summary>

  <div class="tool-body">

    <div style="
      width:100%;
      height:520px;
      border:1px solid #262a30;
      border-radius:12px;
      overflow:hidden;
      background:#0f1113;
    ">
      <iframe
        src="https://drmjp93-ldlcal.netlify.app"
        style="width:100%;height:100%;border:0;"
        loading="lazy"
        referrerpolicy="no-referrer"
      ></iframe>
    </div>

  </div>
</details>

<!-- ================= GCS CALCULATOR ================= -->
  
<details class="tool" data-system="neuro">
  <summary>
    <div>
      <div class="tool-title">Glasgow Coma Scale (GCS)</div>
      <div class="tool-sub">Level of consciousness assessment</div>
    </div>
    <div>‚ñæ</div>
  </summary>

  <div class="tool-body">

    <!-- EYE -->
    
    <div class="step">
      <div class="step-title">Eye Opening (E)</div>
      <div class="options">
        <button onclick="setGCS('eye',4,this)">Spontaneous (4)</button>
        <button onclick="setGCS('eye',3,this)">To speech (3)</button>
        <button onclick="setGCS('eye',2,this)">To pain (2)</button>
        <button onclick="setGCS('eye',1,this)">None (1)</button>
      </div>
    </div>

    <!-- VERBAL -->
    
    <div class="step">
      <div class="step-title">Verbal Response (V)</div>
      <div class="options">
        <button onclick="setGCS('verbal',5,this)">Oriented (5)</button>
        <button onclick="setGCS('verbal',4,this)">Confused (4)</button>
        <button onclick="setGCS('verbal',3,this)">Inappropriate (3)</button>
        <button onclick="setGCS('verbal',2,this)">Incomprehensible (2)</button>
        <button onclick="setGCS('verbal',1,this)">None (1)</button>
      </div>
    </div>

    <!-- MOTOR -->
    
    <div class="step">
      <div class="step-title">Motor Response (M)</div>
      <div class="options">
        <button onclick="setGCS('motor',6,this)">Obeys commands (6)</button>
        <button onclick="setGCS('motor',5,this)">Localizes pain (5)</button>
        <button onclick="setGCS('motor',4,this)">Withdraws (4)</button>
        <button onclick="setGCS('motor',3,this)">Flexion (3)</button>
        <button onclick="setGCS('motor',2,this)">Extension (2)</button>
        <button onclick="setGCS('motor',1,this)">None (1)</button>
      </div>
    </div>

    <!-- RESULT -->
    <div id="gcs-result" class="result hidden"></div>

    <!-- INTERPRETATION -->
    <div id="gcs-info" class="monitor hidden"></div>

  </div>
</details>

<script>
const gcsScore = { eye: 0, verbal: 0, motor: 0 };

function setGCS(type, value, btn){
  btn.parentElement.querySelectorAll('button')
    .forEach(b => b.classList.remove('selected'));
  btn.classList.add('selected');

  gcsScore[type] = value;
  calculateGCS();
}

function calculateGCS(){
  const total = gcsScore.eye + gcsScore.verbal + gcsScore.motor;
  if(total === 0) return;

  const result = document.getElementById('gcs-result');
  const info = document.getElementById('gcs-info');

  result.className = 'result ' + (total <= 8 ? 'warn' : total <= 12 ? 'info' : 'success');
  result.innerHTML = `<strong>GCS = ${total}</strong>`;
  result.classList.remove('hidden');

  let interpretation = '';
  if(total <= 8){
    interpretation = 'Severe head injury ‚Üí Consider airway protection & ICU care.';
  } else if(total <= 12){
    interpretation = 'Moderate head injury ‚Üí Close monitoring required.';
  } else {
    interpretation = 'Mild head injury ‚Üí Continue observation.';
  }

  info.textContent = interpretation;
  info.classList.remove('hidden');
}
</script>

<!-- ================= MENTZER INDEX ================= -->
  
<details class="tool" data-system="Hematology">
  <summary>
    <div>
      <div class="tool-title">Mentzer Index</div>
      <div class="tool-sub">Thalassemia trait vs Iron Deficiency Anemia</div>
    </div>
    <div>‚ñæ</div>
  </summary>

  <div class="tool-body">

    <!-- INPUT -->
    <div class="step">
      <div class="step-title">Enter CBC Values</div>

      <div style="display:flex;gap:10px;flex-wrap:wrap">
        <input
          id="mentzer-mcv"
          type="number"
          placeholder="MCV (fL)"
          style="flex:1;padding:12px;border-radius:10px;
          border:1px solid var(--border);background:#0b0d10;color:var(--text)"
        >

        <input
          id="mentzer-rbc"
          type="number"
          step="0.1"
          placeholder="RBC (million/¬µL)"
          style="flex:1;padding:12px;border-radius:10px;
          border:1px solid var(--border);background:#0b0d10;color:var(--text)"
        >
      </div>

      <button
        onclick="(function(){
          const mcv = Number(document.getElementById('mentzer-mcv').value);
          const rbc = Number(document.getElementById('mentzer-rbc').value);
          const result = document.getElementById('mentzer-result');

          if(!mcv || !rbc || rbc <= 0){
            result.className = 'result warn';
            result.textContent = 'Please enter valid MCV and RBC values.';
            result.classList.remove('hidden');
            return;
          }

          const index = (mcv / rbc).toFixed(1);

          if(index < 13){
            result.className = 'result success';
            result.innerHTML =
              '<strong>Mentzer Index = ' + index +
              '</strong><br>Suggestive of <b>Thalassemia trait</b>';
          } else {
            result.className = 'result warn';
            result.innerHTML =
              '<strong>Mentzer Index = ' + index +
              '</strong><br>Suggestive of <b>Iron Deficiency Anemia</b>';
          }

          result.classList.remove('hidden');
        })()"
        style="
          margin-top:14px;
          width:100%;
          padding:12px;
          border-radius:10px;
          border:none;
          background:var(--accent);
          color:#fff;
          font-weight:700;
          cursor:pointer
        ">
        Calculate Mentzer Index
      </button>
    </div>

    <!-- RESULT -->
    <div id="mentzer-result" class="result hidden"></div>

    <!-- INTERPRETATION -->
    <div class="monitor">
      <b>Formula:</b> MCV √∑ RBC count<br><br>

      <b>&lt; 13</b> ‚Üí Thalassemia trait likely<br>
      <b>&gt; 13</b> ‚Üí Iron Deficiency Anemia likely<br><br>

      <span style="color:var(--muted);font-size:0.85rem">
        Screening tool only ‚Äî confirm with iron studies / Hb electrophoresis
      </span>
    </div>

  </div>
</details>



<!-- ================= OXYGEN CYLINDER DURATION ================= -->
  
<details class="tool" data-system="icu">
  <summary>
    <div>
      <div class="tool-title">Oxygen Cylinder Duration</div>
      <div class="tool-sub">Estimate remaining oxygen time at given flow rate</div>
    </div>
    <div>‚ñæ</div>
  </summary>

  <div class="tool-body">

    <!-- INPUTS -->
    <div class="step">
      <div class="step-title">Cylinder details</div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <select id="o2-cylinder"
          style="padding:12px;border-radius:10px;border:1px solid var(--border);
                 background:#0b0d10;color:var(--text)">
          <option value="">Select cylinder type</option>
          <option value="7">B cylinder (‚âà7 L)</option>
          <option value="10">C cylinder (‚âà10 L)</option>
          <option value="46.7">D cylinder (‚âà46.7 L)</option>
          <option value="28">E cylinder (‚âà28 L)</option>
          <option value="700">Jumbo / Manifold</option>
        </select>

        <input id="o2-pressure" type="number"
          placeholder="Current pressure (bar / kg/cm¬≤)"
          style="padding:12px;border-radius:10px;border:1px solid var(--border);
                 background:#0b0d10;color:var(--text)">
      </div>

      <input id="o2-flow" type="number" step="0.1"
        placeholder="Oxygen flow (L/min)"
        style="margin-top:12px;width:100%;padding:12px;
               border-radius:10px;border:1px solid var(--border);
               background:#0b0d10;color:var(--text)">

      <button onclick="calcO2Time()" style="
        margin-top:14px;
        width:100%;
        padding:12px;
        border-radius:10px;
        border:none;
        background:var(--accent);
        color:#fff;
        font-weight:700;
        cursor:pointer">
        Calculate Duration
      </button>
    </div>

    <!-- RESULT -->
    <div id="o2-result" class="result hidden"></div>

    <!-- INFO CARD -->
    <div class="monitor">
      <b>Pressure unit instructions:</b><br>
      ‚Ä¢ <b>DO NOT enter PSI</b><br>
      ‚Ä¢ Enter pressure in <b>bar or kg/cm¬≤ only</b><br>
      ‚Ä¢ 1 bar ‚âà 1 kg/cm¬≤ (‚âà2% difference, clinically acceptable)<br><br>

      <b>How to identify cylinder type:</b><br>
      ‚Ä¢ Printed / engraved on cylinder body or neck<br>
      ‚Ä¢ Supplier label or color code (varies)<br><br>

      <b>Clinical notes:</b><br>
      ‚Ä¢ Calculation is <b>approximate</b><br>
      ‚Ä¢ Humidifier, leaks, NRBM/HFNC reduce duration<br>
      ‚Ä¢ <b>20 bar kept as safety reserve</b><br>
      ‚Ä¢ Do not run cylinder to zero
    </div>

  </div>
</details>

<script>
function calcO2Time(){
  const waterCap = Number(document.getElementById('o2-cylinder').value);
  const pressure = Number(document.getElementById('o2-pressure').value);
  const flow = Number(document.getElementById('o2-flow').value);
  const res = document.getElementById('o2-result');

  if(!waterCap || !pressure || !flow || flow <= 0){
    res.className = 'result warn';
    res.textContent = 'Please select cylinder type and enter valid pressure and flow.';
    res.classList.remove('hidden');
    return;
  }

  const reserve = 20; // bar
  const usablePressure = pressure - reserve;

  if(usablePressure <= 0){
    res.className = 'result warn';
    res.textContent = 'Pressure too low after safety reserve.';
    res.classList.remove('hidden');
    return;
  }

  const totalLiters = waterCap * usablePressure;
  const totalMinutes = totalLiters / flow;

  const hrs = Math.floor(totalMinutes / 60);
  const mins = Math.round(totalMinutes % 60);

  res.className = 'result success';
  res.innerHTML = `
    Remaining oxygen time ‚âà <b>${hrs} hr ${mins} min</b><br>
    <span style="font-size:0.85rem">
      (Usable pressure: ${usablePressure} bar ¬∑ Flow: ${flow} L/min)
    </span>
  `;
  res.classList.remove('hidden');
}
</script>

  
<!-- ================= ABG INTERPRETATION (ADVANCED) ================= -->

  
<details class="tool" data-system="icu">
  <summary>
    <div>
      <div class="tool-title">ABG Interpretation (Advanced)</div>
      <div class="tool-sub">Primary disorder, compensation & mixed states</div>
    </div>
    <div>‚ñæ</div>
  </summary>

  <div class="tool-body">

    <!-- INPUT -->
    <div class="step">
      <div class="step-title">Enter ABG values</div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <input id="abg_ph" type="number" step="0.01" placeholder="pH"
          style="padding:12px;border-radius:10px;border:1px solid var(--border);
          background:#0b0d10;color:var(--text)">

        <input id="abg_paco2" type="number" step="1" placeholder="PaCO‚ÇÇ (mmHg)"
          style="padding:12px;border-radius:10px;border:1px solid var(--border);
          background:#0b0d10;color:var(--text)">

        <input id="abg_hco3" type="number" step="1" placeholder="HCO‚ÇÉ‚Åª (mEq/L)"
          style="padding:12px;border-radius:10px;border:1px solid var(--border);
          background:#0b0d10;color:var(--text)">

        <input id="abg_pao2" type="number" step="1" placeholder="PaO‚ÇÇ (mmHg)"
          style="padding:12px;border-radius:10px;border:1px solid var(--border);
          background:#0b0d10;color:var(--text)">
      </div>

      <button onclick="interpretABGAdvanced()" style="
        margin-top:14px;
        width:100%;
        padding:12px;
        border-radius:10px;
        border:none;
        background:var(--accent);
        color:#fff;
        font-weight:700;
        cursor:pointer">
        Interpret ABG
      </button>
    </div>

    <!-- RESULT -->
    <div id="abg_result" class="result hidden"></div>

    <!-- INFO -->
    <div class="monitor">
      <b>Normal reference:</b><br>
      ‚Ä¢ pH: 7.35 ‚Äì 7.45<br>
      ‚Ä¢ PaCO‚ÇÇ: 35 ‚Äì 45 mmHg<br>
      ‚Ä¢ HCO‚ÇÉ‚Åª: 22 ‚Äì 26 mEq/L<br><br>

      <b>Note:</b> This advanced tool checks expected compensation to
      detect mixed acid‚Äìbase disorders.
    </div>

  </div>
</details>

<script>
function interpretABGAdvanced() {

  const ph = parseFloat(document.getElementById('abg_ph').value);
  const co2 = parseFloat(document.getElementById('abg_paco2').value);
  const hco3 = parseFloat(document.getElementById('abg_hco3').value);
  const o2 = parseFloat(document.getElementById('abg_pao2').value);
  const res = document.getElementById('abg_result');

  if (isNaN(ph) || isNaN(co2) || isNaN(hco3)) {
    res.className = 'result warn';
    res.innerHTML = 'Please enter valid pH, PaCO‚ÇÇ and HCO‚ÇÉ‚Åª values.';
    res.classList.remove('hidden');
    return;
  }

  let acidBase = '';
  let primary = '';
  let compensation = '';
  let mixed = false;

  /* STEP 1: ACIDEMIA / ALKALEMIA */
  if (ph < 7.35) acidBase = 'Acidemia';
  else if (ph > 7.45) acidBase = 'Alkalemia';
  else acidBase = 'Normal pH (suggests full compensation or mixed disorder)';

  /* STEP 2: PRIMARY DISORDER */
  if (ph < 7.35) {
    if (co2 > 45) primary = 'Primary Respiratory Acidosis';
    else if (hco3 < 22) primary = 'Primary Metabolic Acidosis';
  }

  if (ph > 7.45) {
    if (co2 < 35) primary = 'Primary Respiratory Alkalosis';
    else if (hco3 > 26) primary = 'Primary Metabolic Alkalosis';
  }

  if (acidBase.startsWith('Normal')) {
    if (co2 > 45 && hco3 > 26)
      primary = 'Respiratory Acidosis with Metabolic Compensation';
    else if (co2 < 35 && hco3 < 22)
      primary = 'Respiratory Alkalosis with Metabolic Compensation';
    else
      primary = 'Mixed Acid‚ÄìBase Disorder';
  }

  /* STEP 3: EXPECTED COMPENSATION */
  if (primary.includes('Metabolic Acidosis')) {
    const expectedCO2 = (1.5 * hco3) + 8;
    if (co2 < expectedCO2 - 2 || co2 > expectedCO2 + 2) mixed = true;
    compensation = `Expected PaCO‚ÇÇ ‚âà ${expectedCO2.toFixed(1)} mmHg (Winter‚Äôs formula)`;
  }

  if (primary.includes('Metabolic Alkalosis')) {
    const expectedCO2 = 0.7 * hco3 + 20;
    if (co2 < expectedCO2 - 5 || co2 > expectedCO2 + 5) mixed = true;
    compensation = `Expected PaCO‚ÇÇ ‚âà ${expectedCO2.toFixed(1)} mmHg`;
  }

  if (primary.includes('Respiratory Acidosis')) {
    const expectedHCO3 = hco3 > 26 ? 'Chronic pattern likely' : 'Acute pattern likely';
    compensation = expectedHCO3;
  }

  if (primary.includes('Respiratory Alkalosis')) {
    const expectedHCO3 = hco3 < 22 ? 'Chronic pattern likely' : 'Acute pattern likely';
    compensation = expectedHCO3;
  }

  /* STEP 4: OXYGENATION */
  let oxygenation = '';
  if (!isNaN(o2)) {
    if (o2 >= 80) oxygenation = 'Normal oxygenation';
    else if (o2 >= 60) oxygenation = 'Mild hypoxemia';
    else oxygenation = 'Severe hypoxemia';
  }

  /* OUTPUT */
  res.className = 'result success';
  res.innerHTML = `
    <b>Acid‚Äìbase status:</b> ${acidBase}<br><br>
    <b>Primary disorder:</b> ${primary}<br><br>
    <b>Compensation:</b> ${compensation}<br>
    ${mixed ? '<br><b>‚ö† Mixed acid‚Äìbase disorder suspected</b>' : ''}<br>
    ${oxygenation ? `<br><b>Oxygenation:</b> ${oxygenation}` : ''}
  `;
  res.classList.remove('hidden');
}
</script>

<!-- ================= CHA2DS2-VASc SCORE ================= -->
  
<details class="tool" data-system="cardio">
  <summary>
    <div>
      <div class="tool-title">CHA‚ÇÇDS‚ÇÇ-VASc Score</div>
      <div class="tool-sub">Stroke risk & indication for anticoagulation in AF</div>
    </div>
    <div>‚ñæ</div>
  </summary>

  <div class="tool-body">

    <div class="step">
      <div class="step-title">Select risk factors</div>

      <div class="options" style="flex-wrap:wrap">
        <button onclick="toggleScore(this,1)">Heart failure</button>
        <button onclick="toggleScore(this,1)">Hypertension</button>
        <button onclick="toggleScore(this,2)">Age ‚â• 75 years</button>
        <button onclick="toggleScore(this,1)">Diabetes</button>
        <button onclick="toggleScore(this,2)">Stroke / TIA</button>
        <button onclick="toggleScore(this,1)">Vascular disease</button>
        <button onclick="toggleScore(this,1)">Age 65‚Äì74 years</button>
        <button onclick="toggleScore(this,1)">Female sex</button>
      </div>

      <button onclick="calcCHA2DS2()" style="
        margin-top:14px;width:100%;
        padding:12px;border-radius:10px;
        background:var(--accent);color:#fff;
        border:none;font-weight:700">
        Calculate CHA‚ÇÇDS‚ÇÇ-VASc
      </button>
    </div>

    <div id="cha2ds2-result" class="result hidden"></div>

    <div class="monitor">
      <b>Interpretation:</b><br>
      ‚Ä¢ Score ‚â•2 (men) or ‚â•3 (women) ‚Üí <b>Start anticoagulation</b><br>
      ‚Ä¢ Score 1 (men) ‚Üí Consider anticoagulation<br>
      ‚Ä¢ Score 0 (men) ‚Üí No anticoagulation
    </div>

  </div>
</details>

<script>
let chaScore = 0;

function toggleScore(btn, val){
  if(btn.classList.contains('selected')){
    btn.classList.remove('selected');
    chaScore -= val;
  } else {
    btn.classList.add('selected');
    chaScore += val;
  }
}

function calcCHA2DS2(){
  const r = document.getElementById('cha2ds2-result');
  let advice = '';

  if(chaScore === 0){
    advice = 'No anticoagulation required.';
  } else if(chaScore === 1){
    advice = 'Consider anticoagulation based on clinical context.';
  } else {
    advice = 'Strong indication to START anticoagulation.';
  }

  r.className = 'result success';
  r.innerHTML = `<b>CHA‚ÇÇDS‚ÇÇ-VASc Score = ${chaScore}</b><br>${advice}`;
  r.classList.remove('hidden');
}
</script>

<!-- ================= HAS-BLED SCORE ================= -->
  
<details class="tool" data-system="cardio">
  <summary>
    <div>
      <div class="tool-title">HAS-BLED Score</div>
      <div class="tool-sub">Bleeding risk assessment in AF</div>
    </div>
    <div>‚ñæ</div>
  </summary>

  <div class="tool-body">

    <div class="step">
      <div class="step-title">Select bleeding risk factors</div>

      <div class="options" style="flex-wrap:wrap">
        <button onclick="toggleHAS(this)">Hypertension</button>
        <button onclick="toggleHAS(this)">Abnormal renal function</button>
        <button onclick="toggleHAS(this)">Abnormal liver function</button>
        <button onclick="toggleHAS(this)">Stroke history</button>
        <button onclick="toggleHAS(this)">Bleeding history</button>
        <button onclick="toggleHAS(this)">Labile INR</button>
        <button onclick="toggleHAS(this)">Elderly (>65 years)</button>
        <button onclick="toggleHAS(this)">Drugs / Alcohol</button>
      </div>

      <button onclick="calcHASBLED()" style="
        margin-top:14px;width:100%;
        padding:12px;border-radius:10px;
        background:var(--accent);color:#fff;
        border:none;font-weight:700">
        Calculate HAS-BLED
      </button>
    </div>

    <div id="hasbled-result" class="result hidden"></div>

    <div class="monitor">
      <b>Important:</b><br>
      ‚Ä¢ Score ‚â•3 = High bleeding risk<br>
      ‚Ä¢ <b>NOT a reason to stop anticoagulation</b><br>
      ‚Ä¢ Correct reversible risk factors and monitor closely
    </div>

  </div>
</details>

<script>
let hasScore = 0;

function toggleHAS(btn){
  if(btn.classList.contains('selected')){
    btn.classList.remove('selected');
    hasScore -= 1;
  } else {
    btn.classList.add('selected');
    hasScore += 1;
  }
}

function calcHASBLED(){
  const r = document.getElementById('hasbled-result');
  const msg = hasScore >= 3
    ? 'High bleeding risk ‚Äî correct risk factors & close follow-up.'
    : 'Acceptable bleeding risk.';

  r.className = hasScore >= 3 ? 'result warn' : 'result success';
  r.innerHTML = `<b>HAS-BLED Score = ${hasScore}</b><br>${msg}`;
  r.classList.remove('hidden');
}
</script>


<!-- ================= EMERGENCY DRUGS (ALL-IN-ONE) ================= -->
  
<style>
  
/* ===== Emergency Drugs ===== */
  
.em-card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:16px;
  padding:14px;
  margin-top:12px;
}

/* Category card */
.em-category{
  background:#0b0d10;
  border:1px solid var(--border);
  border-radius:14px;
  margin-bottom:12px;
  overflow:hidden;
}

.em-category summary{
  list-style:none;
  cursor:pointer;
  padding:14px 16px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.em-category summary::-webkit-details-marker{display:none}

.em-cat-title{
  font-weight:600;
  font-size:0.95rem;
}

.em-arrow{
  opacity:0.6;
  transition:transform .25s ease;
}

details[open] .em-arrow{
  transform:rotate(180deg);
  opacity:1;
}

/* Drugs list */
.em-body{
  padding:8px 12px 12px;
  border-top:1px solid var(--border);
}

.em-drug{
  display:flex;
  justify-content:space-between;
  gap:12px;
  padding:8px 4px;
  font-size:0.9rem;
  border-bottom:1px dashed var(--border);
}

.em-drug:last-child{border-bottom:none}

.em-drug-name{
  font-weight:600;
  color:var(--text);
}

.em-drug-dose{
  color:var(--muted);
  white-space:nowrap;
  text-align:right;
}
</style>

<details class="tool pinned" data-system="icu">
  <summary>
    <div>
      <div class="tool-title">Emergency Drugs (MICU / ICCU)</div>
      <div class="tool-sub">Commonly used emergency medications with standard doses</div>
    </div>
    <div>‚ñæ</div>
  </summary>

  <div class="tool-body">
    <div class="em-card">

      <!-- Vasopressors -->
      <details class="em-category">
        <summary>
          <span class="em-cat-title">Vasopressors</span>
          <span class="em-arrow">‚ñæ</span>
        </summary>
        <div class="em-body">
          <div class="em-drug"><span class="em-drug-name">Adrenaline</span><span class="em-drug-dose">0.05‚Äì0.5 ¬µg/kg/min IV</span></div>
          <div class="em-drug"><span class="em-drug-name">Dopamine</span><span class="em-drug-dose">5‚Äì20 ¬µg/kg/min IV</span></div>
          <div class="em-drug"><span class="em-drug-name">Noradrenaline</span><span class="em-drug-dose">0.05‚Äì0.5 ¬µg/kg/min IV</span></div>
          <div class="em-drug"><span class="em-drug-name">Phenylephrine</span><span class="em-drug-dose">0.5‚Äì5 ¬µg/kg/min IV</span></div>
          <div class="em-drug"><span class="em-drug-name">Vasopressin</span><span class="em-drug-dose">0.01‚Äì0.04 units/min IV</span></div>
        </div>
      </details>

      <!-- Antiarrhythmics -->
      <details class="em-category">
        <summary>
          <span class="em-cat-title">Antiarrhythmics</span>
          <span class="em-arrow">‚ñæ</span>
        </summary>
        <div class="em-body">
          <div class="em-drug"><span class="em-drug-name">Adenosine</span><span class="em-drug-dose">6 mg IV ‚Üí 12 mg</span></div>
          <div class="em-drug"><span class="em-drug-name">Amiodarone</span><span class="em-drug-dose">150 mg IV over 10 min</span></div>
          <div class="em-drug"><span class="em-drug-name">Lidocaine</span><span class="em-drug-dose">1‚Äì1.5 mg/kg IV</span></div>
          <div class="em-drug"><span class="em-drug-name">Magnesium sulfate</span><span class="em-drug-dose">2 g IV over 10‚Äì15 min</span></div>
          <div class="em-drug"><span class="em-drug-name">Metoprolol</span><span class="em-drug-dose">5 mg IV slow (√ó3)</span></div>
        </div>
      </details>

      <!-- Sedatives / Analgesics -->
      <details class="em-category">
        <summary>
          <span class="em-cat-title">Sedatives / Analgesics</span>
          <span class="em-arrow">‚ñæ</span>
        </summary>
        <div class="em-body">
          <div class="em-drug"><span class="em-drug-name">Dexmedetomidine</span><span class="em-drug-dose">0.2‚Äì0.7 ¬µg/kg/hr IV</span></div>
          <div class="em-drug"><span class="em-drug-name">Fentanyl</span><span class="em-drug-dose">1‚Äì2 ¬µg/kg IV</span></div>
          <div class="em-drug"><span class="em-drug-name">Midazolam</span><span class="em-drug-dose">0.05‚Äì0.1 mg/kg IV</span></div>
          <div class="em-drug"><span class="em-drug-name">Morphine</span><span class="em-drug-dose">2‚Äì4 mg IV slow</span></div>
          <div class="em-drug"><span class="em-drug-name">Propofol</span><span class="em-drug-dose">5‚Äì50 ¬µg/kg/min IV</span></div>
        </div>
      </details>

      <!-- Electrolytes -->
      <details class="em-category">
        <summary>
          <span class="em-cat-title">Electrolytes / Metabolic</span>
          <span class="em-arrow">‚ñæ</span>
        </summary>
        <div class="em-body">
          <div class="em-drug"><span class="em-drug-name">Calcium gluconate</span><span class="em-drug-dose">10 mL of 10% IV</span></div>
          <div class="em-drug"><span class="em-drug-name">Dextrose 25%</span><span class="em-drug-dose">100‚Äì200 mL IV</span></div>
          <div class="em-drug"><span class="em-drug-name">Potassium chloride</span><span class="em-drug-dose">10‚Äì20 mEq/hr IV</span></div>
          <div class="em-drug"><span class="em-drug-name">Sodium bicarbonate</span><span class="em-drug-dose">50‚Äì100 mEq IV</span></div>
        </div>
      </details>

      <!-- Anticoagulation -->
      <details class="em-category">
        <summary>
          <span class="em-cat-title">Anticoagulation / Thrombolysis</span>
          <span class="em-arrow">‚ñæ</span>
        </summary>
        <div class="em-body">
          <div class="em-drug"><span class="em-drug-name">Enoxaparin</span><span class="em-drug-dose">1 mg/kg SC 12-hourly</span></div>
          <div class="em-drug"><span class="em-drug-name">Heparin (UFH)</span><span class="em-drug-dose">80 U/kg bolus ‚Üí 18 U/kg/hr</span></div>
          <div class="em-drug"><span class="em-drug-name">Streptokinase</span><span class="em-drug-dose">1.5 MU IV over 60 min</span></div>
          <div class="em-drug"><span class="em-drug-name">Tenecteplase</span><span class="em-drug-dose">Weight-based IV bolus</span></div>
        </div>
      </details>

    </div>
  </div>
</details>


<!-- ================= INFUSION RATE CALCULATOR ================= -->

<details class="tool pinned" data-system="icu">
  <summary>
    <div>
      <div class="tool-title">Infusion Rate Calculator</div>
      <div class="tool-sub">Calculate mL/hr for ICU infusions</div>
    </div>
    <div>‚ñæ</div>
  </summary>

  <div class="tool-body">

<button onclick="openDoseModal()" class="ghost-btn">
  üìå View common ICU infusion doses
</button>

    <!-- DRUG PREPARATION -->
    <div class="form-card">
      <div class="form-section-title">Drug preparation</div>

      <div class="form-group">
        <span class="form-label">Strength per mL</span>
        <div class="form-row">
          <input id="inf-strength" type="number" step="0.01" class="form-input">
          <select id="inf-unit" class="form-select">
            <option value="mg">mg/mL</option>
            <option value="mcg">¬µg/mL</option>
          </select>
        </div>
      </div>

      <div class="form-row-2" style="margin-top:12px">
        <div class="form-group">
          <span class="form-label">Ampoule volume (mL)</span>
          <input id="inf-amp-vol" type="number" step="0.1" class="form-input">
        </div>

        <div class="form-group">
          <span class="form-label">Total number of ampoules</span>
          <input id="inf-amp-count" type="number" step="1" class="form-input">
        </div>
      </div>

      <div class="form-group" style="margin-top:12px">
        <span class="form-label">Final dilution volume (mL)</span>
        <input id="inf-dilution" type="number" step="1" class="form-input">
      </div>
    </div>

    <!-- DOSE -->
    <div class="form-card">
      <div class="form-section-title">Dose to be administered</div>

      <div class="form-group">
        <span class="form-label">Prescribed dose</span>
        <div class="form-row">
          <input id="inf-dose" type="number" step="0.01" class="form-input">
          <select id="inf-dose-unit" class="form-select">
            <option value="mg_hr">mg/hr</option>
            <option value="mg_kg_hr">mg/kg/hr</option>
            <option value="mcg_min">¬µg/min</option>
            <option value="mcg_kg_min">¬µg/kg/min</option>
          </select>
        </div>
      </div>

      <div class="form-group" style="margin-top:12px">
        <span class="form-label">Patient weight (kg)</span>
        <input id="inf-weight" type="number" step="0.1" class="form-input">
      </div>
    </div>

    <!-- ACTION -->
   
    <button onclick="calcInfusion()" class="primary-btn">
      Calculate Infusion Rate
    </button>

    <!-- RESULT -->
    <div id="inf-result" class="result hidden"></div>

    <!-- NOTES -->
    <div class="monitor">
      <b>Clinical notes:</b><br>
      ‚Ä¢ Uses actual ampoule volume √ó count<br>
      ‚Ä¢ Supports mg & ¬µg dosing<br>
      ‚Ä¢ Weight mandatory for kg-based dosing<br>
      ‚Ä¢ Always double-check vasopressors & insulin
    </div>

  </div>
</details>

<script>
function calcInfusion(){
  const strength = Number(document.getElementById('inf-strength').value);
  const unit = document.getElementById('inf-unit').value;
  const ampVol = Number(document.getElementById('inf-amp-vol').value);
  const ampCount = Number(document.getElementById('inf-amp-count').value);
  const dilution = Number(document.getElementById('inf-dilution').value);

  const dose = Number(document.getElementById('inf-dose').value);
  const doseUnit = document.getElementById('inf-dose-unit').value;
  const weight = Number(document.getElementById('inf-weight').value);

  const res = document.getElementById('inf-result');

  if(!strength || !ampVol || !ampCount || !dilution || !dose){
    showError("Please fill all required fields.");
    return;
  }

  // Total drug loaded (mg)
  let totalMg = strength * ampVol * ampCount;
  if(unit === 'mcg') totalMg /= 1000;

  const concentration = totalMg / dilution; // mg/mL
  let requiredMgHr = 0;

  if(doseUnit === 'mg_hr'){
    requiredMgHr = dose;
  } else if(doseUnit === 'mg_kg_hr'){
    if(!weight) return showError("Weight required for kg-based dosing.");
    requiredMgHr = dose * weight;
  } else if(doseUnit === 'mcg_min'){
    requiredMgHr = (dose * 60) / 1000;
  } else if(doseUnit === 'mcg_kg_min'){
    if(!weight) return showError("Weight required for kg-based dosing.");
    requiredMgHr = (dose * weight * 60) / 1000;
  }

  const mlHr = requiredMgHr / concentration;

  res.className = 'result success';
  res.innerHTML = `
    <strong>Infusion rate ‚âà ${mlHr.toFixed(2)} mL/hr</strong><br><br>
    Total drug loaded: <b>${totalMg.toFixed(2)} mg</b><br>
    Final concentration: <b>${concentration.toFixed(4)} mg/mL</b>
  `;
  res.classList.remove('hidden');

  function showError(msg){
    res.className = 'result warn';
    res.textContent = msg;
    res.classList.remove('hidden');
  }
}
</script>

<!-- ================= tools block above this ================= -->

</div>

<!-- ================= PREGNANCY ================= -->
<div id="preg-tools" class="hidden">

<details class="tool" data-system="obstetric">
<summary>
  <div>
    <div class="tool-title">Hepatitis B in Pregnancy</div>
    <div class="tool-sub">Vertical transmission prevention</div>
  </div>
  <div>‚ñæ</div>
</summary>

<div class="tool-body">

<div class="step">
  <div class="step-title">HBV DNA</div>
  <div class="options">
    <button onclick="pregHBV(true)">‚â• 200,000 IU/mL</button>
    <button onclick="pregHBV(false)">&lt; 200,000 IU/mL</button>
  </div>
</div>

<div id="preg-result" class="hidden"></div>

</div>
</details>
</div>

</main>

<script>
/* MODE */
function switchMode(mode,btn){
  document.querySelectorAll('.mode-btn').forEach(b=>b.classList.remove('active'));
  btn.classList.add('active');
  document.getElementById('general-tools').style.display = mode==='general'?'block':'none';
  document.getElementById('preg-tools').style.display = mode==='preg'?'block':'none';
  applyFilters();
}

/* SEARCH + SORT (UNIFIED) */
const searchInput=document.getElementById('searchInput');
searchInput.addEventListener('input',applyFilters);

document.querySelectorAll('#global-tabs .tab').forEach(tab=>{
  tab.onclick=()=>{
    document.querySelectorAll('#global-tabs .tab').forEach(t=>t.classList.remove('active'));
    tab.classList.add('active');
    applyFilters();
  };
});

function applyFilters(){
  const q=searchInput.value.toLowerCase();
  const filter=document.querySelector('#global-tabs .tab.active').dataset.filter;
  const container=document.getElementById('preg-tools').style.display==='block'
    ? document.getElementById('preg-tools')
    : document.getElementById('general-tools');

  container.querySelectorAll('.tool').forEach(tool=>{
    const okText=tool.innerText.toLowerCase().includes(q);
    const okFilter=filter==='all'||tool.dataset.system===filter;
    tool.style.display=okText&&okFilter?'block':'none';
  });
}

/* COMMON */
function select(btn){
  btn.parentElement.querySelectorAll('button').forEach(b=>b.classList.remove('selected'));
  btn.classList.add('selected');
}
function show(id){document.getElementById(id).classList.remove('hidden')}

/* GENERAL HBV LOGIC (CORRECTED) */
function hbvDNA(level){
  if(level==='low'){monitor();return;}
  show('g3');
}
function monitor(){
  const r=document.getElementById('result');
  const m=document.getElementById('monitor');
  r.className='result warn';
  r.textContent='No treatment now';
  r.classList.remove('hidden');
  m.textContent='Monitor ALT 3‚Äì6 monthly ¬∑ HBV DNA 6‚Äì12 monthly';
  m.classList.remove('hidden');
}
function treat(){
  const r=document.getElementById('result');
  const m=document.getElementById('monitor');
  m.classList.add('hidden');
  r.className='result success';
  r.innerHTML=`
    <strong>START ANTIVIRAL TREATMENT</strong><br><br>
    <b>Recommended drugs:</b>
    <ul>
      <li>Tenofovir disoproxil fumarate (TDF)</li>
      <li>Entecavir</li>
    </ul>
    <small>Avoid Lamivudine monotherapy due to resistance.</small>
  `;
  r.classList.remove('hidden');
}

/* PREGNANCY */
function pregHBV(high){
  const r=document.getElementById('preg-result');
  r.className='result '+(high?'success':'info');
  r.innerHTML=high
    ? 'START Tenofovir at 28‚Äì32 weeks ‚Üí Stop 4 weeks postpartum.<br>Infant: HBIG + Vaccine'
    : 'No maternal antiviral.<br>Infant: HBIG + Vaccine';
  r.classList.remove('hidden');
}

/* ================= A‚ÄìZ SORT (GLOBAL) ================= */

function sortToolsAlphabetically(){
  const container = document.getElementById('general-tools');
  if(!container) return;

  const tools = Array.from(container.querySelectorAll('.tool'));

  const pinned = tools.filter(t => t.classList.contains('pinned'));
  const normal = tools.filter(t => !t.classList.contains('pinned'));

  normal.sort((a,b)=>{
    const A = a.querySelector('.tool-title')?.innerText.toLowerCase() || '';
    const B = b.querySelector('.tool-title')?.innerText.toLowerCase() || '';
    return A.localeCompare(B);
  });

  [...pinned, ...normal].forEach(t => container.appendChild(t));
}

document.addEventListener('DOMContentLoaded', sortToolsAlphabetically);

</script>

<!-- ================= ICU INFUSION DOSE MODAL ================= -->
  
<div id="doseModal" class="dose-modal hidden">

  <div class="dose-card">
    <div class="dose-header">
      <span>Common ICU Infusion Doses</span>
      <button onclick="closeDoseModal()">‚úï</button>
    </div>

    <div class="dose-body">

      <div class="dose-section">
        <h4>Vasopressors</h4>
        <div class="dose-row">Noradrenaline <span>0.05‚Äì0.5 ¬µg/kg/min</span></div>
        <div class="dose-row">Adrenaline <span>0.05‚Äì0.5 ¬µg/kg/min</span></div>
        <div class="dose-row">Dopamine <span>5‚Äì20 ¬µg/kg/min</span></div>
        <div class="dose-row">Phenylephrine <span>0.5‚Äì5 ¬µg/kg/min</span></div>
        <div class="dose-row">Vasopressin <span>0.01‚Äì0.04 units/min</span></div>
      </div>

      <div class="dose-section">
        <h4>Sedation / Analgesia</h4>
        <div class="dose-row">Propofol <span>5‚Äì50 ¬µg/kg/min</span></div>
        <div class="dose-row">Dexmedetomidine <span>0.2‚Äì0.7 ¬µg/kg/hr</span></div>
        <div class="dose-row">Midazolam <span>0.02‚Äì0.1 mg/kg/hr</span></div>
        <div class="dose-row">Fentanyl <span>1‚Äì2 ¬µg/kg/hr</span></div>
      </div>

      <div class="dose-section">
        <h4>Others</h4>
        <div class="dose-row">Insulin infusion <span>0.05‚Äì0.1 units/kg/hr</span></div>
        <div class="dose-row">Amiodarone <span>0.5‚Äì1 mg/min (post bolus)</span></div>
        <div class="dose-row">Heparin infusion <span>12‚Äì18 units/kg/hr</span></div>
      </div>

      <div class="dose-note">
        Reference ranges only. Always titrate to MAP, HR, lactate & protocol.
      </div>

    </div>
  </div>
</div>

<script>
function openDoseModal(){
  document.getElementById('doseModal').classList.remove('hidden');
}
function closeDoseModal(){
  document.getElementById('doseModal').classList.add('hidden');
}
</script>

<script>
setTimeout(() => {
  const splash = document.getElementById('splash');
  if (splash) splash.style.display = 'none';
}, 1200); // 1.2 seconds
</script>

<script>
(async function () {
  const el = document.getElementById("visitCount");
  if (!el) return;

  try {
    const resp = await fetch(
      "https://api.counterapi.dev/v1/drmjp93in/clinical-tools-visits/up"
    );
    const j = await resp.json();

    if (j && j.count !== undefined) {
      let count = j.count;

      // Optional rounding (recommended)
      if (count >= 1000) {
        count = Math.floor(count / 100) * 100 + "+";
      }

      el.textContent = count;
    }
  } catch (e) {
    el.textContent = "‚Äî";
  }
})();
</script>
<footer style="
  margin-top:40px;
  text-align:center;
  font-size:0.85rem;
  color:var(--muted);
">

  <!-- OVERLAY WRAPPER -->
  <div style="
    background: rgba(0,0,0,0.6);      /* 60% black */
    padding:18px 12px;
    border-radius:16px;
    max-width:900px;
    margin:0 auto;

    /* OPTIONAL PREMIUM LOOK */
    backdrop-filter: blur(4px);
    -webkit-backdrop-filter: blur(4px);
  ">

    <div style="margin-bottom:8px;">
      Compiled by <b style="color:var(--text)">drmjp93</b> with ü©µ
    </div>

    <div style="max-width:820px;margin:0 auto;line-height:1.5;">
      <b>Disclaimer:</b> These clinical tools are intended for
      <b>academic and educational purposes only</b>.
      They are designed to support clinical reasoning but
      <b>do not replace professional medical judgment</b>,
      patient examination, or individualized decision-making.
      Always correlate with clinical context and current guidelines.
    </div>

  </div>

</footer>

</body>
</html>
